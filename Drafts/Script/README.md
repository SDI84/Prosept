Это черновик скрипта, согласно замечаниям.

Функция очистки текста изменеа и вынесена из тела основной.
Где изменила (строки в новом скрипте):

1. Загрузку, строки 48-49, а зачем orient='index' и потом транспонировать?
2. Строки 80-85, без apply, перемножение матриц
3. Строка 92 - без iloc
4. 93-94 - тензоры в списки
5. 98-104 без tens
6. 114 - to_dict, от бэкенда
7. а, и 37 - список словарей
