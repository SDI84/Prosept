Это черновик скрипта, согласно замечаниям.

Функция очистки текста изменеа и вынесена из тела основной.
Где изменила (строки в новом скрипте):

1. Загрузку, строки 55-56, а зачем orient='index' и потом транспонировать?
2. Строки 81-83, 86, без apply, перемножение матриц
3. Строка 93 - без iloc
4. 94-95 - тензоры в списки
5. 99-105 без tens
6. 115 - to_dict, от бэкенда
7. а, и 44 - список словарей
